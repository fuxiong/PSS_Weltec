@model PSS_Weltec.Models.User

 @{
     Layout = null;
 }


<!DOCTYPE html>

<html>
<head>
    <meta charset="UTF-8" />
    <title>PSS_Weltec</title>
    <link rel="stylesheet" type="text/css" href="../../Scripts/jquery-easyui-1.4.3/themes/default/easyui.css">
    <link rel="stylesheet" type="text/css" href="../../Scripts/jquery-easyui-1.4.3/themes/icon.css">
    <script type="text/javascript" src="../../Scripts/jquery-easyui-1.4.3/jquery.min.js"></script>
    <script type="text/javascript" src="../../Scripts/jquery-easyui-1.4.3/jquery.easyui.min.js"></script>
</head>
    <body class="easyui-layout" style="overflow-y: hidden"  scroll="no">
        <div region="north" split="true" border="false" style="overflow: hidden; height: 30px;background: url(Images/layout-header.gif) #7f99be repeat-x center 50%; line-height: 20px;color: #fff; font-family: Verdana, 微软雅黑,黑体">
            <span style="float:right; padding-right:20px;" class="head">@*欢迎 管理员 <a href="#" id="editpass">修改密码</a>*@ <a href="#" id="loginOut">Log Out</a></span> 
            <span style="padding-left:10px; font-size: 16px; "><img src="Images/blocks.gif" width="20" height="20"/>Welcome to Project Selection System</span>
        </div>
        <div region="south" split="true" style="height: 25px; background: #D2E0F2; ">
            <div class="footer">   @DateTime.Now.Year PSS_Weltec</div>
        </div>
        <div region="west" hide="true" split="true" title="Navigation" style="width:180px;" id="west">
            <div id="nav" class="easyui-accordion" fit="true" border="false"> 
                <!--  导航内容 --> 
            </div>
        </div>
        <div id="mainPanle" region="center" style="background: #eee; overflow-y:hidden">
            <div id="tabs" class="easyui-tabs"  fit="true" border="false" >
                <div title="Main" style="padding:20px;overflow:hidden; color:red; " >
                    <h1 style="font-size:24px;">Welcome to Project Selection System!</h1>
                </div>
            </div>
        </div>
        <div id="mm" class="easyui-menu" style="width:150px;">
          <div id="mm-tabupdate">Reload</div>
          <div class="menu-sep"></div>
          <div id="mm-tabclose">Close</div>
          <div id="mm-tabcloseall">All Close</div>
          @*<div id="mm-tabcloseother">除此之外全部关闭</div>
          <div class="menu-sep"></div>
          <div id="mm-tabcloseright">当前页右侧全部关闭</div>
          <div id="mm-tabcloseleft">当前页左侧全部关闭</div>
          <div class="menu-sep"></div>*@
          <div id="mm-exit">Exit</div>
        </div>
    </body>
</html>

<script type="text/javascript">
    var _menus = {
        "menus": [
                  {
                      "menuid": "1", "icon": "icon-sys", "menuname": "User Management",
                      "menus": [
                        { "menuid": "12", "menuname": "User List", "icon": "icon-sys", "url": "../User/UserIndex" },
                        { "menuid": "13", "menuname": "Personal Profile", "url": "menu1/class.html" },
                        { "menuid": "14", "menuname": "Change Password", "icon": "icon-reload", "url": "demo2.html" }
                        //{ "menuid": "15", "menuname": "菜单", "icon": "icon-set", "url": "demo.html" },
                        //{ "menuid": "16", "menuname": "菜单", "icon": "icon-log", "url": "demo1.html" }
                      ]
                  },
       {
           "menuid": "2", "icon": "icon-remove", "menuname": "Project Management",
           "menus": [{ "menuid": "21", "menuname": "Project List", "icon": "icon-filter", "url": "menu2/tree2.html" },
                   { "menuid": "22", "menuname": "Project Dicussion", "icon": "icon-nav", "url": "demo1.html" }
           ]
       },
       {
           "menuid": "3", "icon": "icon-sys", "menuname": "New Idea Management",
           "menus": [{ "menuid": "31", "menuname": "New Idea List", "icon": "icon-nav", "url": "demo1.html" },
                   { "menuid": "32", "menuname": "Propose a New Idea", "icon": "icon-nav", "url": "demo2.html" },
                   { "menuid": "33", "menuname": "Idea Discussion", "icon": "icon-nav", "url": "demo2.html" },
                   { "menuid": "34", "menuname": "Approve Ideas", "icon": "icon-nav", "url": "demo2.html" }
           ]
       },
       {
           "menuid": "4", "icon": "icon-sys", "menuname": "Team Management",
           "menus": [{ "menuid": "41", "menuname": "Build a Team", "icon": "icon-nav", "url": "demo.html" },
                   { "menuid": "42", "menuname": "Join a Team", "icon": "icon-nav", "url": "demo1.html" },
                   { "menuid": "43", "menuname": "Sumbit a bid", "icon": "icon-nav", "url": "demo2.html" },
                   { "menuid": "44", "menuname": "Approved Team", "icon": "icon-nav", "url": "demo2.html" }
           ]
       },
       {
           "menuid": "5", "icon": "icon-sys", "menuname": "Configuration",
           "menus": [{ "menuid": "51", "menuname": "Trimester", "icon": "icon-nav", "url": "../Configuration/TrimesterIndex" },
                   { "menuid": "52", "menuname": "News", "icon": "icon-nav", "url": "../Configuration/NewIndex" }
           ]
       }
    ]
};

    $(function () {
        tabCloseEven();
        tabClose();
        InitLeftMenu();
        $('#loginOut').click(function () {
            $.messager.confirm('Info', 'Do you want to log out?', function (r) {
                if (r) {
                    location.href = '/Main/MainIndex';
                }
            });
        })
    });

    function tabClose() {
        /*双击关闭TAB选项卡*/
        $(".tabs-inner").dblclick(function () {
            var subtitle = $(this).children(".tabs-closable").text();
            $('#tabs').tabs('close', subtitle);
        })
        /*为选项卡绑定右键*/
        $(".tabs-inner").bind('contextmenu', function (e) {
            $('#mm').menu('show', {
                left: e.pageX,
                top: e.pageY
            });

            var subtitle = $(this).children(".tabs-closable").text();

            $('#mm').data("currtab", subtitle);
            $('#tabs').tabs('select', subtitle);
            return false;
        });
    }

    //绑定右键菜单事件
    function tabCloseEven() {
        //刷新
        $('#mm-tabupdate').click(function () {
            var currTab = $('#tabs').tabs('getSelected');
            var url = $(currTab.panel('options').content).attr('src');
            $('#tabs').tabs('update', {
                tab: currTab,
                options: {
                    content: createFrame(url)
                }
            })
        })
        //关闭当前
        $('#mm-tabclose').click(function () {
            var currtab_title = $('#mm').data("currtab");
            $('#tabs').tabs('close', currtab_title);
        })
        //全部关闭
        $('#mm-tabcloseall').click(function () {
            $('.tabs-inner span').each(function (i, n) {
                var t = $(n).text();
                $('#tabs').tabs('close', t);
            });
        });
        //关闭除当前之外的TAB
        $('#mm-tabcloseother').click(function () {
            $('#mm-tabcloseright').click();
            $('#mm-tabcloseleft').click();
        });
        //关闭当前右侧的TAB
        $('#mm-tabcloseright').click(function () {
            var nextall = $('.tabs-selected').nextAll();
            if (nextall.length == 0) {
                //msgShow('系统提示','后边没有啦~~','error');
                alert('后边没有啦~~');
                return false;
            }
            nextall.each(function (i, n) {
                var t = $('a:eq(0) span', $(n)).text();
                $('#tabs').tabs('close', t);
            });
            return false;
        });
        //关闭当前左侧的TAB
        $('#mm-tabcloseleft').click(function () {
            var prevall = $('.tabs-selected').prevAll();
            if (prevall.length == 0) {
                alert('到头了，前边没有啦~~');
                return false;
            }
            prevall.each(function (i, n) {
                var t = $('a:eq(0) span', $(n)).text();
                $('#tabs').tabs('close', t);
            });
            return false;
        });

        //退出
        $("#mm-exit").click(function () {
            $('#mm').menu('hide');
        })
    }

    function createFrame(url) {
        var s = '<iframe scrolling="auto" frameborder="0"  src="' + url + '" style="width:100%;height:100%;"></iframe>';
        return s;
    }

    function addTab(subtitle, url,icon) {
        if (!$('#tabs').tabs('exists', subtitle)) {
            $('#tabs').tabs('add', {
                title: subtitle,
                content: createFrame(url),
                icon:icon,
                closable: true
            });
        } else {
            $('#tabs').tabs('select', subtitle);
            $('#mm-tabupdate').click();
        }
        tabClose();
    }

    //初始化左侧
    function InitLeftMenu() {
        $("#nav").accordion({ animate: false });//为id为nav的div增加手风琴效果，并去除动态滑动效果
        $.each(_menus.menus, function (i, n) {//$.each 遍历_menu中的元素
            var menulist = '';
            menulist += '<ul>';
            $.each(n.menus, function (j, o) {
                menulist += '<li><div><a ref="' + o.menuid + '" href="#" rel="' + o.url + '" ><span class="icon ' + o.icon
                    + '" >&nbsp;</span><span class="nav">' + o.menuname + '</span></a></div></li> ';
            })
            menulist += '</ul>';

            $('#nav').accordion('add', {
                title: n.menuname,
                content: menulist,
                iconCls: 'icon ' + n.icon
            });

        });

        $('.easyui-accordion li a').click(function () {//当单击菜单某个选项时，在右边出现对用的内容
            var tabTitle = $(this).children('.nav').text();//获取超链里span中的内容作为新打开tab的标题

            var url = $(this).attr("rel");
            var menuid = $(this).attr("ref");//获取超链接属性中ref中的内容
            var icon = getIcon(menuid, icon);

            addTab(tabTitle, url,icon);//增加tab
            $('.easyui-accordion li div').removeClass("selected");
                $(this).parent().addClass("selected");
            }).hover(function () {
                $(this).parent().addClass("hover");
            }, function () {
                $(this).parent().removeClass("hover");
            });

            //选中第一个
            var panels = $('#nav').accordion('panels');
            var t = panels[0].panel('options').title;
            $('#nav').accordion('select', t);
        }
</script>
